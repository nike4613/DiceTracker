<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DiceTracker</title>
    <base href="/">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    <link rel="stylesheet" href="index.css">
    <<script src="monaco/node_modules/monaco-editor/min/vs/loader.js"></script>
    <script>
        (() => {
            require.config({ paths: { vs: "monaco/node_modules/monaco-editor/min/vs" } });

            let monacoOnReady = undefined;
            let monacoReady = false;

            window.editor = {
                create: function (elem, text, lang) {
                    function doCreate() {
                        return monaco.editor.create(elem, {
                            value: text,
                            language: lang
                        });
                    }

                    if (monacoReady) {
                        return Promise.resolve(doCreate());
                    } else {
                        return new Promise((res, rej) => {
                            monacoOnReady = function () {
                                res(doCreate())
                            };
                        });
                    }
                },
                onChange: function (editor, invoke) {
                    console.log("onChange called", editor, invoke);
                    editor.onDidChangeModelContent(function (e) {
                        console.log("editor content changed", editor, invoke, e);
                        invoke.Invoke(editor);
                    });
                }
            };

            require(["vs/editor/editor.main"], function () {
                monacoReady = true;

                if (monacoOnReady)
                    monacoOnReady();
            });
        })();
    </script>
</head>
<body>
    <div id="main" class="main is-dark">Loading...</div>

    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>
</body>
</html>